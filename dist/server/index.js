(()=>{"use strict";const e=require("express"),t=require("react/jsx-runtime"),i=require("react-dom/server"),s=require("mysql"),{SQL_HOST:a,SQL_USERNAME:n,SQL_PASSWORD:d}=process.env,c=(e,t)=>new Promise(((i,c)=>{const o=(0,s.createConnection)({host:a,user:n,password:d,database:"baby_log"});o.query(e,t,((e,t)=>{e?c(e):i(t)})),o.end()})),o=({children:e,title:i,criticalCss:s})=>(0,t.jsxs)("html",Object.assign({lang:"en"},{children:[(0,t.jsxs)("head",{children:[(0,t.jsx)("title",{children:i},void 0),(0,t.jsx)("meta",{charSet:"utf-8"},void 0),(0,t.jsx)("meta",{httpEquiv:"X-UA-Compatible",content:"IE=edge"},void 0),(0,t.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"},void 0),s&&(0,t.jsx)("link",{rel:"stylesheet",href:"/static/style.css"},void 0)]},void 0),(0,t.jsxs)("body",{children:[e,!s&&(0,t.jsx)("script",{src:"/static/app.js",type:"text/javascript"},void 0)]},void 0)]}),void 0),r=require("react"),l=({allData:e,selected:i})=>(0,t.jsx)("div",Object.assign({className:"activity-chkbox-group"},{children:e.map((e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"checkbox",id:`nav-chkbox-option-${e.id}`,name:"activity",value:e.id,defaultChecked:i.includes(e.id)},void 0),(0,t.jsx)("label",Object.assign({className:`badge badge-color-${e.id}`,htmlFor:`nav-chkbox-option-${e.id}`},{children:e.name}),void 0)]},e.id)))}),void 0),v=({allData:e,selected:i})=>(0,t.jsxs)("form",Object.assign({className:"nav-form",action:"/"},{children:[(0,t.jsx)(l,{allData:e,selected:i},void 0),(0,t.jsx)("input",{type:"submit",value:"🔍 Filter"},void 0)]}),void 0),m=({data:e})=>(0,t.jsx)("table",Object.assign({className:"activity-table"},{children:e.map((e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.time},void 0),(0,t.jsx)("td",{children:e.events.map((e=>(0,t.jsx)("a",Object.assign({href:`/delete-confirm/${e.id}`},{children:(0,t.jsx)("span",Object.assign({className:`badge badge-color-${e.activity_id}`},{children:e.activity_name}),void 0)}),e.id)))},void 0)]},e.time)))}),void 0),j=({activityDefinition:e,selectedActivity:i,eventList:s})=>(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)("a",Object.assign({href:"/create"},{children:(0,t.jsx)("button",Object.assign({type:"button",className:"create-btn"},{children:"➕ Create Event"}),void 0)}),void 0)},void 0),(0,t.jsxs)("div",Object.assign({className:"activity-layout"},{children:[(0,t.jsx)(v,{allData:e,selected:i},void 0),(0,t.jsx)(m,{data:s},void 0)]}),void 0)]},void 0),h=()=>(0,t.jsx)("a",Object.assign({className:"back-link",href:"/"},{children:"Back to logs"}),void 0),u=({activityDefinition:e,selectedActivity:i,timeOptions:s})=>(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)(h,{},void 0),(0,t.jsxs)("form",Object.assign({action:"/create-event",method:"post"},{children:[(0,t.jsxs)("div",Object.assign({className:"create-layout"},{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",Object.assign({htmlFor:"event-time"},{children:"Time"}),void 0),s.map((e=>{const i=`time-options-${e.id}`;return(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"radio",id:i,name:"time",value:e.id,defaultChecked:e.isNow},void 0),(0,t.jsx)("label",Object.assign({className:"create-time",htmlFor:i},{children:e.name}),void 0)]},i)}))]},void 0),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",Object.assign({htmlFor:"selected-activity"},{children:"Activity"}),void 0),(0,t.jsx)(l,{selected:i,allData:e},void 0)]},void 0)]}),void 0),(0,t.jsx)("input",{className:"create-btn",type:"submit",value:"🔼 Submit Event"},void 0)]}),void 0)]},void 0),x=require("date-fns"),g=[-100,-90,-80,-70,-60,-50,-40,-30,-20,-10,0,10,20],y=(e,t)=>{const i=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,s=e.getMinutes(),a=s<10?`0${s}`:s;return{id:`${i} ${e.getHours()}:${a}:00`,name:`${e.getHours()}:${a}${t?" (now)":""}`,isNow:t}},p=e=>(0,x.format)(e,"MM-dd hh:mm a"),b=({id:e,event_time:i,activity_id:s,activity_name:a})=>(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)(h,{},void 0),(0,t.jsxs)("form",Object.assign({action:"/delete-event",method:"post"},{children:[(0,t.jsxs)("div",Object.assign({className:"delete-layout"},{children:[(0,t.jsxs)("h3",{children:["✋ Are you sure you want to DELETE ",(0,t.jsx)("span",Object.assign({className:`badge badge-color-${s}`},{children:a}),void 0)," at ",(0,t.jsx)("u",{children:p(i)},void 0),"?"]},void 0),(0,t.jsx)("input",{type:"hidden",name:"id",value:e},void 0)]}),void 0),(0,t.jsx)("input",{className:"create-btn",type:"submit",value:"⛔ Delete Event"},void 0)]}),void 0)]},void 0),f=({message:e,error:i})=>(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)(h,{},void 0),(0,t.jsxs)("h4",{children:[(0,t.jsx)("span",{dangerouslySetInnerHTML:{__html:i?"&#10060;":"&#9989;"}},void 0),"  ",e,"."]},void 0)]},void 0);var O=function(e,t,i,s){return new(i||(i=Promise))((function(a,n){function d(e){try{o(s.next(e))}catch(e){n(e)}}function c(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(d,c)}o((s=s.apply(e,t||[])).next())}))};const E={"app.js":"./dist/client/index.js","style.css":"./dist/client/main.css"},_=e();_.use(e.urlencoded({extended:!0})),_.get("/create",((e,s)=>O(void 0,void 0,void 0,(function*(){const e=(e=>{const t=e.getFullYear(),i=e.getMonth(),s=e.getDate(),a=e.getHours(),n=e.getMinutes(),d=10*Math.floor(n/10),c=d===n,o=new Date(t,i,s,a,n,0),r=new Date(t,i,s,a,d,0),l=g.map((e=>{const t=(0,x.add)(r,{minutes:e});return y(t,0===e&&c)}));if(!c){const e=g.indexOf(0)+1;l.splice(e,0,y(o,!0))}return l})(new Date),a=yield c("select * from activity_def"),n=(0,t.jsx)(o,Object.assign({title:"Create an event",criticalCss:!0},{children:(0,t.jsx)(u,{activityDefinition:a,selectedActivity:[],timeOptions:e},void 0)}),void 0),d=(0,i.renderToStaticMarkup)(n);s.status(200),s.send(`<!DOCTYPE html>${d}`)})))),_.get("/delete-confirm/:id",((e,s)=>O(void 0,void 0,void 0,(function*(){const a=yield c("SELECT * from logs where id = ?",[e.params.id]);if(1!==a.length)return void s.redirect("/error");const n=a[0],d=yield c("SELECT * from activity_def where id = ?",[n.activity_id.toString()]);if(1!==d.length)return void s.redirect("/error");const r={id:parseInt(e.params.id,10),event_time:n.event_time,activity_id:n.activity_id,activity_name:d[0].name,activity_value:n.activity_value,child_id:n.child_id},l=(0,t.jsx)(o,Object.assign({title:"Delete an event activity",criticalCss:!0},{children:(0,t.jsx)(b,Object.assign({},r),void 0)}),void 0),v=(0,i.renderToStaticMarkup)(l);s.status(200),s.send(`<!DOCTYPE html>${v}`)})))),_.post("/create-event",((e,s)=>O(void 0,void 0,void 0,(function*(){const{time:a,activity:n}=e.body;if(Array.isArray(n))n.forEach((e=>O(void 0,void 0,void 0,(function*(){yield c("INSERT INTO logs (event_time, activity_id, child_id) VALUES (?, ?, ?)",[a,e,1])}))));else{if(!n){const e=(0,t.jsx)(o,Object.assign({title:"Failed",criticalCss:!0},{children:(0,t.jsx)(f,{message:"Creating event failed",error:!0},void 0)}),void 0),a=(0,i.renderToStaticMarkup)(e);return s.status(500),void s.send(`<!DOCTYPE html>${a}`)}yield c("INSERT INTO logs (event_time, activity_id, child_id) VALUES (?, ?, ?)",[a,n,1])}const d=(0,t.jsx)(o,Object.assign({title:"Succeed",criticalCss:!0},{children:(0,t.jsx)(f,{message:"Creating event succeeded",error:!1},void 0)}),void 0),r=(0,i.renderToStaticMarkup)(d);s.status(200),s.send(`<!DOCTYPE html>${r}`)})))),_.post("/delete-event",((e,s)=>O(void 0,void 0,void 0,(function*(){try{yield c("DELETE from logs WHERE id = ?",[e.body.id]);const a=(0,t.jsx)(o,Object.assign({title:"Successfully ",criticalCss:!0},{children:(0,t.jsx)(f,{message:"Deleting event succeeded",error:!1},void 0)}),void 0),n=(0,i.renderToStaticMarkup)(a);s.status(200),s.send(`<!DOCTYPE html>${n}`)}catch(e){const a=(0,t.jsx)(o,Object.assign({title:"Failed",criticalCss:!0},{children:(0,t.jsx)(f,{message:"Deleting event failed",error:!0},void 0)}),void 0),n=(0,i.renderToStaticMarkup)(a);s.status(500),s.send(`<!DOCTYPE html>${n}`)}})))),_.get("/error",((e,s)=>{const a=(0,t.jsx)(o,Object.assign({title:"Failed",criticalCss:!0},{children:(0,t.jsx)(f,{message:"Bad Request",error:!0},void 0)}),void 0),n=(0,i.renderToStaticMarkup)(a);s.status(400),s.send(`<!DOCTYPE html>${n}`)})),_.get("/static/:name",((e,t)=>{t.sendFile(E[e.params.name],{root:process.cwd()})})),_.get("/",((e,s)=>O(void 0,void 0,void 0,(function*(){const a=yield c("select * from activity_def"),n=a.reduce(((e,t)=>(e[t.id]=t,e)),{});let d,r=null;const{activity:l}=e.query;Array.isArray(l)?(d=l.map((e=>parseInt(e,10))),r=`WHERE activity_id in (${d.join(",")})`):l?(d=[parseInt(l.toString(),10)],r=`WHERE activity_id = ${l}`):(d=a.map((e=>e.id)),r="");const v=`SELECT * FROM logs ${r} ORDER BY event_time DESC LIMIT 200`,m=yield c(v),h=new Set,u={};m.forEach((e=>{const t=p(e.event_time);t in u?u[t].push(Object.assign({activity_name:n[e.activity_id].name},e)):u[t]=[Object.assign({activity_name:n[e.activity_id].name},e)],h.add(t)}),{});const x=Array.from(h).map((e=>({time:e,events:u[e]}))),g=(0,t.jsx)(o,Object.assign({title:"Baby Logs",criticalCss:!0},{children:(0,t.jsx)(j,{eventList:x,activityDefinition:a,selectedActivity:d},void 0)}),void 0),y=(0,i.renderToStaticMarkup)(g);s.status(200),s.send(`<!DOCTYPE html>${y}`)})))),_.listen(3001,(()=>{console.log("app is running on: http://localhost:3001")}))})();