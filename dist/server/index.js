(()=>{"use strict";var e={556:e=>{e.exports=require("prom-client")}},t={};function i(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=require("express"),t=require("react/jsx-runtime"),s=require("react-dom/server"),a=require("mysql"),{SQL_HOST:n,SQL_USERNAME:d,SQL_PASSWORD:c}=process.env,o=(e,t)=>new Promise(((i,s)=>{const o=(0,a.createConnection)({host:n,user:d,password:c,database:"baby_log"});o.query(e,t,((e,t)=>{e?s(e):i(t)})),o.end()})),r=({children:e,title:i,criticalCss:s})=>(0,t.jsxs)("html",Object.assign({lang:"en"},{children:[(0,t.jsxs)("head",{children:[(0,t.jsx)("title",{children:i},void 0),(0,t.jsx)("meta",{charSet:"utf-8"},void 0),(0,t.jsx)("meta",{httpEquiv:"X-UA-Compatible",content:"IE=edge"},void 0),(0,t.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"},void 0),(0,t.jsx)("link",{rel:"shortcut icon",href:"data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAABAREQAQEREAEBERABAREQBQEREBRM9XQKSQwAMs1gEhbpqCXU0KyUKAC1xAlpPNABAREQAQEREAUBERAVAREQDQEREAkBERANAREQAfF9FAAAiTAJ7UUEUwlwFgc9hA/TrfQbty2wGbmFOLhEJMF0EalUyAEBERABAREQDQEREBUBERAJAREQIQEREBd95VADBc2sR3nEmk95pBvfWYwP/9XQB//V2AfHleAeJj2coGAApYgRzUzAAQEREAEBERAFAREQAQUVEBCk4QAqcamcT34IwlPd8CfrubwH/12UE/+JpAv/oawD/5m0B99twB46SYSYXAC5kBG9PMABAREQAAAAAAKp7WQCZcWkUy4s5meuQE/r6hAX/93QB/9lnEOXKYgriz18D/9JgAv/SYQL30WYFjpZcIxgAL2QD2WsHAJxsowCFWtUMxpVOkeOmHProlxL/84gJ/+10FN7NYjZIvGMNRLpZB9m5VAT/u1QD/75WA/fLXwWMoV8jFAAQlQF6VbINhkLFgKJdkvfZnir/6qAS/92DH+DFaD1M//8AAIMAFgC4WQhEqk4H2aNJBf+xTwT/12MC9d1pBICuYRoPhU27iIU8t/SGOb7/oluM/86JPOS/dEJMES9SCTlDQgX/qAAAAAAPAK5RBkSkSgvfyFwD/9pkAf/TYwPzz2oGhoWN1XWFh9XthXXR/4do0v+Ma8vhiFvWQiQsFwM+REEMPkRFBYIS/wCcOGg5mTV12chXLv/xdAH/8YEG7eiIC3SFwegGhpLebIaA2PGFedT/h3HZ/4pf2NeJStJBKTcfAylEGgmQQW09jjanzocwvP+XPJ3/1mYy8fOCBG32oRAGhYTbAIWI2wiHgdyHh3rZ+IZr1P+JXdj/ikzX14k6x0GJR3g8iUa00YlDzv+KRNP/jkTJ9KtRhH6PXg8PABxlAkBERAIMGwABhXfbDolx3IyIZtj4h1fT/4lI1P+JPcTdi1TE14lY1/+HV9T/jFfP9KJYpH7cZi8KFjpBA0BERAVAREQCQERECCc1GQSLZ9oOil/ajIlS1/iHQ8v/hz3D/4lm2P+Kbtz/imvQ9JNjm4SjWjEOnV1ZAEBERABAREQBQEREAEBERARAREQLKTsbBIta2w6KTdaKiD7H9oU7uv+HeNb/iH/W8JNyqHuQVioOMT8/CkFERAVAREQAQEREAEBERABAREQAQEREBEBERAgmRw4Cd0W4DHw1sH+EObb1gYLN7m93s2x0PiUHcllzAEBERARAREQIQEREA0BERAAAAAAAQEREAEBERABAREQCQEREAm4onwBdJYINdTihh2tsqXYgOz0IQ1FwAEBERABAREQAQEREAkBERAJAREQAIAgAAAAAAAAQAAAAgAEAAMAAAACAAAAAAYAAAADAAAAAQAAAAAAAAIAAAAAAAAAAAAQAAIABAACAEQAAxDAAAA=="},void 0),s&&(0,t.jsx)("link",{rel:"stylesheet",href:"/static/style.css"},void 0)]},void 0),(0,t.jsxs)("body",{children:[e,!s&&(0,t.jsx)("script",{src:"/static/app.js",type:"text/javascript"},void 0)]},void 0)]}),void 0),l=require("react"),A=require("classnames");var v=i.n(A);const m={badge:"_Aamr","badge-color-1":"Etd84","badge-color-2":"tDFBL","badge-color-3":"u8Jx4","badge-color-4":"KCZs9","badge-color-5":"_jSMN","badge-color-6":"YCZP9"},j=({activityId:e,text:i})=>(0,t.jsx)("span",Object.assign({className:`${m.badge} ${m[`badge-color-${e}`]}`},{children:i}),void 0),h=({allData:e,selected:i,showTwoCol:s})=>{const a=v()("m_a5h",{XB1uK:s});return(0,t.jsx)("div",Object.assign({className:a},{children:e.map((e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"checkbox",id:`nav-chkbox-option-${e.id}`,name:"activity",value:e.id,defaultChecked:i.includes(e.id)},void 0),(0,t.jsx)("label",Object.assign({htmlFor:`nav-chkbox-option-${e.id}`},{children:(0,t.jsx)(j,{activityId:e.id,text:e.name},void 0)}),void 0)]},e.id)))}),void 0)},E=({allData:e,selected:i})=>(0,t.jsxs)("form",Object.assign({className:"_fVc5",action:"/"},{children:[(0,t.jsx)(h,{showTwoCol:!0,allData:e,selected:i},void 0),(0,t.jsx)("input",{type:"submit",value:"ðŸ” Filter"},void 0)]}),void 0),u=({data:e})=>(0,t.jsx)("table",Object.assign({className:"TXs1J"},{children:e.map((e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.time},void 0),(0,t.jsx)("td",{children:e.events.map((e=>(0,t.jsx)("a",Object.assign({href:`/delete-confirm/${e.id}`},{children:(0,t.jsx)(j,{activityId:e.activity_id,text:e.activity_name},void 0)}),e.id)))},void 0)]},e.time)))}),void 0),g="_2chV",x=({activityDefinition:e,selectedActivity:i,eventList:s})=>(0,t.jsxs)(l.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("a",Object.assign({href:"/create"},{children:(0,t.jsx)("button",Object.assign({type:"button",className:g},{children:"âž• Create Event"}),void 0)}),void 0),"Â ",(0,t.jsx)("a",Object.assign({href:"/metrics-ui"},{children:(0,t.jsx)("button",Object.assign({type:"button",className:g},{children:"âž• Create Metric"}),void 0)}),void 0)]},void 0),(0,t.jsxs)("div",Object.assign({className:"n3eo5"},{children:[(0,t.jsx)(E,{allData:e,selected:i},void 0),(0,t.jsx)(u,{data:s},void 0)]}),void 0)]},void 0),b=()=>(0,t.jsx)("a",Object.assign({className:"b782w",href:"/"},{children:"Back to logs"}),void 0),p=({type:e,children:i})=>(0,t.jsx)("button",Object.assign({type:e,className:"_qmzl"},{children:i}),void 0),y=({activityDefinition:e,selectedActivity:i,timeOptions:s})=>(0,t.jsxs)(l.Fragment,{children:[(0,t.jsx)(b,{},void 0),(0,t.jsxs)("form",Object.assign({action:"/create-event",method:"post"},{children:[(0,t.jsxs)("div",Object.assign({className:"UW9i5"},{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",Object.assign({htmlFor:"event-time"},{children:"Time"}),void 0),(0,t.jsx)("div",Object.assign({className:"rtykI"},{children:s.map((e=>{const i=`time-options-${e.id}`;return(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"radio",id:i,name:"time",value:e.id,defaultChecked:e.isNow},void 0),(0,t.jsx)("label",Object.assign({className:"_bga0",htmlFor:i},{children:e.name}),void 0)]},i)}))}),void 0)]},void 0),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",Object.assign({htmlFor:"selected-activity"},{children:"Activity"}),void 0),(0,t.jsx)(h,{selected:i,allData:e,showTwoCol:!1},void 0)]},void 0)]}),void 0),(0,t.jsx)(p,Object.assign({type:"submit"},{children:"ðŸ”¼ Submit Event"}),void 0)]}),void 0)]},void 0),O=require("date-fns"),R=[-400,10],f=(e,t)=>{const i=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,s=e.getMinutes(),a=s<10?`0${s}`:s;return{id:`${i} ${e.getHours()}:${a}:00`,name:`${e.getHours()}:${a}${t?" (now)":""}`,isNow:t}},Q=e=>(0,O.format)(e,"MM-dd hh:mm a"),B=({id:e,event_time:i,activity_id:s,activity_name:a})=>(0,t.jsxs)(l.Fragment,{children:[(0,t.jsx)(b,{},void 0),(0,t.jsxs)("form",Object.assign({action:"/delete-event",method:"post"},{children:[(0,t.jsxs)("div",Object.assign({className:"_KIe2"},{children:[(0,t.jsxs)("h3",{children:["âœ‹ Are you sure you want to DELETEÂ ",(0,t.jsx)(j,{activityId:s,text:a},void 0),"Â at ",(0,t.jsx)("u",{children:Q(i)},void 0),"?"]},void 0),(0,t.jsx)("input",{type:"hidden",name:"id",value:e},void 0)]}),void 0),(0,t.jsx)(p,Object.assign({type:"submit"},{children:"â›” Delete Event"}),void 0)]}),void 0)]},void 0),C="_Dvvd",T="_JXgq",D=()=>(0,t.jsxs)("form",Object.assign({action:"/metrics",method:"POST"},{children:[(0,t.jsx)("h3",{children:"Please input formular amount: "},void 0),(0,t.jsxs)("div",{children:[(0,t.jsx)("button",Object.assign({className:C,"data-amt":"-10"},{children:"-10 ml"}),void 0),(0,t.jsx)("button",Object.assign({className:C,"data-amt":"-30"},{children:"-30 ml"}),void 0),(0,t.jsx)("button",Object.assign({className:C,"data-amt":"30"},{children:"+30 ml"}),void 0),(0,t.jsx)("button",Object.assign({className:C,"data-amt":"60"},{children:"+60 ml"}),void 0)]},void 0),(0,t.jsx)("input",{className:T,type:"number",name:"amt"},void 0),(0,t.jsx)("button",Object.assign({id:"submit",type:"submit",className:T},{children:"Submit"}),void 0)]}),void 0),_=({message:e,error:i})=>(0,t.jsxs)(l.Fragment,{children:[(0,t.jsx)(b,{},void 0),(0,t.jsxs)("h4",{children:[(0,t.jsx)("span",{dangerouslySetInnerHTML:{__html:i?"&#10060;":"&#9989;"}},void 0),"Â  ",e,"."]},void 0)]},void 0);var S=function(e,t,i,s){return new(i||(i=Promise))((function(a,n){function d(e){try{o(s.next(e))}catch(e){n(e)}}function c(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(d,c)}o((s=s.apply(e,t||[])).next())}))};const w=i(556),I=w.register,F=new w.Counter({name:"baby_track",help:"baby_track"}),M={"app.js":"./dist/client/index.js","style.css":"./dist/client/main.css"},N=e();N.use(e.urlencoded({extended:!0})),N.get("/metrics",((e,t)=>{t.status(200).set("Content-Type","text/plain"),I.metrics().then((e=>{t.end(e)}))})),N.get("/metrics-ui",((e,i)=>{const a=(0,t.jsx)(r,Object.assign({title:"Log Baby Metrics",criticalCss:!0},{children:(0,t.jsx)(D,{},void 0)}),void 0),n=(0,s.renderToStaticMarkup)(a);i.send(`<!DOCTYPE html>${n}`)})),N.post("/metrics",((e,i)=>{F.inc(parseInt(e.body.amt));const a=(0,t.jsx)(r,Object.assign({title:"Succeed",criticalCss:!0},{children:(0,t.jsx)(_,{message:"Creating formula metrics successfully",error:!1},void 0)}),void 0),n=(0,s.renderToStaticMarkup)(a);i.status(200),i.send(`<!DOCTYPE html>${n}`)})),N.get("/create",((e,i)=>S(void 0,void 0,void 0,(function*(){const e=(e=>{const t=e.getFullYear(),i=e.getMonth(),s=e.getDate(),a=e.getHours(),n=e.getMinutes(),d=10*Math.floor(n/10),c=d===n,o=new Date(t,i,s,a,n,0),r=new Date(t,i,s,a,d,0),l=[];for(let e=R[1];e>=R[0];e-=10)l.push(e);const A=l.map((e=>{const t=(0,O.add)(r,{minutes:e});return f(t,0===e&&c)}));if(!c){const e=l.indexOf(0);A.splice(e,0,f(o,!0))}return A})(new Date),a=yield o("select * from activity_def"),n=(0,t.jsx)(r,Object.assign({title:"Create an event",criticalCss:!0},{children:(0,t.jsx)(y,{activityDefinition:a,selectedActivity:[],timeOptions:e},void 0)}),void 0),d=(0,s.renderToStaticMarkup)(n);i.status(200),i.send(`<!DOCTYPE html>${d}`)})))),N.get("/delete-confirm/:id",((e,i)=>S(void 0,void 0,void 0,(function*(){const a=yield o("SELECT\n      a1.*, a2.name as activity_name\n    FROM logs a1 LEFT JOIN activity_def a2\n      ON a1.activity_id = a2.id\n    WHERE a1.id = ?",[e.params.id]);if(1!==a.length)return void i.redirect("/error");const n=a[0],d={id:parseInt(e.params.id,10),event_time:n.event_time,activity_id:n.activity_id,activity_name:n.activity_name,activity_value:n.activity_value,child_id:n.child_id},c=(0,t.jsx)(r,Object.assign({title:"Delete an event activity",criticalCss:!0},{children:(0,t.jsx)(B,Object.assign({},d),void 0)}),void 0),l=(0,s.renderToStaticMarkup)(c);i.status(200),i.send(`<!DOCTYPE html>${l}`)})))),N.post("/create-event",((e,i)=>S(void 0,void 0,void 0,(function*(){const{time:a,activity:n}=e.body;if(Array.isArray(n))n.forEach((e=>S(void 0,void 0,void 0,(function*(){yield o("INSERT INTO logs (event_time, activity_id, child_id) VALUES (?, ?, ?)",[a,e,1])}))));else{if(!n){const e=(0,t.jsx)(r,Object.assign({title:"Failed",criticalCss:!0},{children:(0,t.jsx)(_,{message:"Creating event failed",error:!0},void 0)}),void 0),a=(0,s.renderToStaticMarkup)(e);return i.status(500),void i.send(`<!DOCTYPE html>${a}`)}yield o("INSERT INTO logs (event_time, activity_id, child_id) VALUES (?, ?, ?)",[a,n,1])}const d=(0,t.jsx)(r,Object.assign({title:"Succeed",criticalCss:!0},{children:(0,t.jsx)(_,{message:"Creating event succeeded",error:!1},void 0)}),void 0),c=(0,s.renderToStaticMarkup)(d);i.status(200),i.send(`<!DOCTYPE html>${c}`)})))),N.post("/delete-event",((e,i)=>S(void 0,void 0,void 0,(function*(){try{yield o("DELETE from logs WHERE id = ?",[e.body.id]);const a=(0,t.jsx)(r,Object.assign({title:"Successfully ",criticalCss:!0},{children:(0,t.jsx)(_,{message:"Deleting event succeeded",error:!1},void 0)}),void 0),n=(0,s.renderToStaticMarkup)(a);i.status(200),i.send(`<!DOCTYPE html>${n}`)}catch(e){const a=(0,t.jsx)(r,Object.assign({title:"Failed",criticalCss:!0},{children:(0,t.jsx)(_,{message:"Deleting event failed",error:!0},void 0)}),void 0),n=(0,s.renderToStaticMarkup)(a);i.status(500),i.send(`<!DOCTYPE html>${n}`)}})))),N.get("/error",((e,i)=>{const a=(0,t.jsx)(r,Object.assign({title:"Failed",criticalCss:!0},{children:(0,t.jsx)(_,{message:"Bad Request",error:!0},void 0)}),void 0),n=(0,s.renderToStaticMarkup)(a);i.status(400),i.send(`<!DOCTYPE html>${n}`)})),N.get("/static/:name",((e,t)=>{t.sendFile(M[e.params.name],{root:process.cwd()})})),N.get("/",((e,i)=>S(void 0,void 0,void 0,(function*(){const a=yield o("select * from activity_def"),n=a.reduce(((e,t)=>(e[t.id]=t,e)),{});let d,c=null;const{activity:l}=e.query;Array.isArray(l)?(d=l.map((e=>parseInt(e,10))),c=`WHERE activity_id in (${d.join(",")})`):l?(d=[parseInt(l.toString(),10)],c=`WHERE activity_id = ${l}`):(d=a.map((e=>e.id)),c="");const A=`SELECT * FROM logs ${c} ORDER BY event_time DESC LIMIT 100`,v=yield o(A),m=new Set,j={};v.forEach((e=>{const t=Q(e.event_time);t in j?j[t].push(Object.assign({activity_name:n[e.activity_id].name},e)):j[t]=[Object.assign({activity_name:n[e.activity_id].name},e)],m.add(t)}),{});const h=Array.from(m).map((e=>({time:e,events:j[e]}))),E=(0,t.jsx)(r,Object.assign({title:"Baby Logs",criticalCss:!0},{children:(0,t.jsx)(x,{eventList:h,activityDefinition:a,selectedActivity:d},void 0)}),void 0),u=(0,s.renderToStaticMarkup)(E);i.status(200),i.send(`<!DOCTYPE html>${u}`)})))),N.listen(3001,(()=>{console.log("app is running on: http://localhost:3001")}))})()})();