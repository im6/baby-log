(()=>{"use strict";const e=require("express"),i=require("react/jsx-runtime"),t=require("react-dom/server"),s=require("mysql"),{SQL_HOST:a,SQL_USERNAME:d,SQL_PASSWORD:n}=process.env,c=(e,i)=>new Promise(((t,c)=>{const o=(0,s.createConnection)({host:a,user:d,password:n,database:"baby_log"});o.query(e,i,((e,i)=>{e?c(e):t(i)})),o.end()})),o=({children:e,title:t,criticalCss:s})=>(0,i.jsxs)("html",Object.assign({lang:"en"},{children:[(0,i.jsxs)("head",{children:[(0,i.jsx)("title",{children:t},void 0),(0,i.jsx)("meta",{charSet:"utf-8"},void 0),(0,i.jsx)("meta",{httpEquiv:"X-UA-Compatible",content:"IE=edge"},void 0),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"},void 0),(0,i.jsx)("link",{rel:"shortcut icon",href:"data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAABAREQAQEREAEBERABAREQBQEREBRM9XQKSQwAMs1gEhbpqCXU0KyUKAC1xAlpPNABAREQAQEREAUBERAVAREQDQEREAkBERANAREQAfF9FAAAiTAJ7UUEUwlwFgc9hA/TrfQbty2wGbmFOLhEJMF0EalUyAEBERABAREQDQEREBUBERAJAREQIQEREBd95VADBc2sR3nEmk95pBvfWYwP/9XQB//V2AfHleAeJj2coGAApYgRzUzAAQEREAEBERAFAREQAQUVEBCk4QAqcamcT34IwlPd8CfrubwH/12UE/+JpAv/oawD/5m0B99twB46SYSYXAC5kBG9PMABAREQAAAAAAKp7WQCZcWkUy4s5meuQE/r6hAX/93QB/9lnEOXKYgriz18D/9JgAv/SYQL30WYFjpZcIxgAL2QD2WsHAJxsowCFWtUMxpVOkeOmHProlxL/84gJ/+10FN7NYjZIvGMNRLpZB9m5VAT/u1QD/75WA/fLXwWMoV8jFAAQlQF6VbINhkLFgKJdkvfZnir/6qAS/92DH+DFaD1M//8AAIMAFgC4WQhEqk4H2aNJBf+xTwT/12MC9d1pBICuYRoPhU27iIU8t/SGOb7/oluM/86JPOS/dEJMES9SCTlDQgX/qAAAAAAPAK5RBkSkSgvfyFwD/9pkAf/TYwPzz2oGhoWN1XWFh9XthXXR/4do0v+Ma8vhiFvWQiQsFwM+REEMPkRFBYIS/wCcOGg5mTV12chXLv/xdAH/8YEG7eiIC3SFwegGhpLebIaA2PGFedT/h3HZ/4pf2NeJStJBKTcfAylEGgmQQW09jjanzocwvP+XPJ3/1mYy8fOCBG32oRAGhYTbAIWI2wiHgdyHh3rZ+IZr1P+JXdj/ikzX14k6x0GJR3g8iUa00YlDzv+KRNP/jkTJ9KtRhH6PXg8PABxlAkBERAIMGwABhXfbDolx3IyIZtj4h1fT/4lI1P+JPcTdi1TE14lY1/+HV9T/jFfP9KJYpH7cZi8KFjpBA0BERAVAREQCQERECCc1GQSLZ9oOil/ajIlS1/iHQ8v/hz3D/4lm2P+Kbtz/imvQ9JNjm4SjWjEOnV1ZAEBERABAREQBQEREAEBERARAREQLKTsbBIta2w6KTdaKiD7H9oU7uv+HeNb/iH/W8JNyqHuQVioOMT8/CkFERAVAREQAQEREAEBERABAREQAQEREBEBERAgmRw4Cd0W4DHw1sH+EObb1gYLN7m93s2x0PiUHcllzAEBERARAREQIQEREA0BERAAAAAAAQEREAEBERABAREQCQEREAm4onwBdJYINdTihh2tsqXYgOz0IQ1FwAEBERABAREQAQEREAkBERAJAREQAIAgAAAAAAAAQAAAAgAEAAMAAAACAAAAAAYAAAADAAAAAQAAAAAAAAIAAAAAAAAAAAAQAAIABAACAEQAAxDAAAA=="},void 0),s&&(0,i.jsx)("link",{rel:"stylesheet",href:"/static/style.css"},void 0)]},void 0),(0,i.jsxs)("body",{children:[e,!s&&(0,i.jsx)("script",{src:"/static/app.js",type:"text/javascript"},void 0)]},void 0)]}),void 0),A=require("react"),r=({allData:e,selected:t})=>(0,i.jsx)("div",Object.assign({className:"activity-chkbox-group"},{children:e.map((e=>(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"checkbox",id:`nav-chkbox-option-${e.id}`,name:"activity",value:e.id,defaultChecked:t.includes(e.id)},void 0),(0,i.jsx)("label",Object.assign({className:`badge badge-color-${e.id}`,htmlFor:`nav-chkbox-option-${e.id}`},{children:e.name}),void 0)]},e.id)))}),void 0),l=({allData:e,selected:t})=>(0,i.jsxs)("form",Object.assign({className:"nav-form",action:"/"},{children:[(0,i.jsx)(r,{allData:e,selected:t},void 0),(0,i.jsx)("input",{type:"submit",value:"🔍 Filter"},void 0)]}),void 0),v=({data:e})=>(0,i.jsx)("table",Object.assign({className:"activity-table"},{children:e.map((e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.time},void 0),(0,i.jsx)("td",{children:e.events.map((e=>(0,i.jsx)("a",Object.assign({href:`/delete-confirm/${e.id}`},{children:(0,i.jsx)("span",Object.assign({className:`badge badge-color-${e.activity_id}`},{children:e.activity_name}),void 0)}),e.id)))},void 0)]},e.time)))}),void 0),E=({activityDefinition:e,selectedActivity:t,eventList:s})=>(0,i.jsxs)(A.Fragment,{children:[(0,i.jsx)("div",{children:(0,i.jsx)("a",Object.assign({href:"/create"},{children:(0,i.jsx)("button",Object.assign({type:"button",className:"wide-btn"},{children:"➕ Create Event"}),void 0)}),void 0)},void 0),(0,i.jsxs)("div",Object.assign({className:"activity-layout"},{children:[(0,i.jsx)(l,{allData:e,selected:t},void 0),(0,i.jsx)(v,{data:s},void 0)]}),void 0)]},void 0),m=()=>(0,i.jsx)("a",Object.assign({className:"back-link",href:"/"},{children:"Back to logs"}),void 0),h=({activityDefinition:e,selectedActivity:t,timeOptions:s})=>(0,i.jsxs)(A.Fragment,{children:[(0,i.jsx)(m,{},void 0),(0,i.jsxs)("form",Object.assign({action:"/create-event",method:"post"},{children:[(0,i.jsxs)("div",Object.assign({className:"create-layout"},{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",Object.assign({htmlFor:"event-time"},{children:"Time"}),void 0),(0,i.jsx)("div",Object.assign({className:"create-time-list"},{children:s.map((e=>{const t=`time-options-${e.id}`;return(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"radio",id:t,name:"time",value:e.id,defaultChecked:e.isNow},void 0),(0,i.jsx)("label",Object.assign({className:"create-time",htmlFor:t},{children:e.name}),void 0)]},t)}))}),void 0)]},void 0),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",Object.assign({htmlFor:"selected-activity"},{children:"Activity"}),void 0),(0,i.jsx)(r,{selected:t,allData:e},void 0)]},void 0)]}),void 0),(0,i.jsx)("input",{className:"wide-btn",type:"submit",value:"🔼 Submit Event"},void 0)]}),void 0)]},void 0),j=require("date-fns"),u=[-200,10],g=(e,i)=>{const t=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,s=e.getMinutes(),a=s<10?`0${s}`:s;return{id:`${t} ${e.getHours()}:${a}:00`,name:`${e.getHours()}:${a}${i?" (now)":""}`,isNow:i}},x=e=>(0,j.format)(e,"MM-dd hh:mm a"),y=({id:e,event_time:t,activity_id:s,activity_name:a})=>(0,i.jsxs)(A.Fragment,{children:[(0,i.jsx)(m,{},void 0),(0,i.jsxs)("form",Object.assign({action:"/delete-event",method:"post"},{children:[(0,i.jsxs)("div",Object.assign({className:"delete-layout"},{children:[(0,i.jsxs)("h3",{children:["✋ Are you sure you want to DELETE ",(0,i.jsx)("span",Object.assign({className:`badge badge-color-${s}`},{children:a}),void 0)," at ",(0,i.jsx)("u",{children:x(t)},void 0),"?"]},void 0),(0,i.jsx)("input",{type:"hidden",name:"id",value:e},void 0)]}),void 0),(0,i.jsx)("input",{className:"wide-btn",type:"submit",value:"⛔ Delete Event"},void 0)]}),void 0)]},void 0),p=({message:e,error:t})=>(0,i.jsxs)(A.Fragment,{children:[(0,i.jsx)(m,{},void 0),(0,i.jsxs)("h4",{children:[(0,i.jsx)("span",{dangerouslySetInnerHTML:{__html:t?"&#10060;":"&#9989;"}},void 0),"  ",e,"."]},void 0)]},void 0);var b=function(e,i,t,s){return new(t||(t=Promise))((function(a,d){function n(e){try{o(s.next(e))}catch(e){d(e)}}function c(e){try{o(s.throw(e))}catch(e){d(e)}}function o(e){var i;e.done?a(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(n,c)}o((s=s.apply(e,i||[])).next())}))};const R={"app.js":"./dist/client/index.js","style.css":"./dist/client/main.css"},f=e();f.use(e.urlencoded({extended:!0})),f.get("/create",((e,s)=>b(void 0,void 0,void 0,(function*(){const e=(e=>{const i=e.getFullYear(),t=e.getMonth(),s=e.getDate(),a=e.getHours(),d=e.getMinutes(),n=10*Math.floor(d/10),c=n===d,o=new Date(i,t,s,a,d,0),A=new Date(i,t,s,a,n,0),r=[];for(let e=u[1];e>=u[0];e-=10)r.push(e);const l=r.map((e=>{const i=(0,j.add)(A,{minutes:e});return g(i,0===e&&c)}));if(!c){const e=r.indexOf(0);l.splice(e,0,g(o,!0))}return l})(new Date),a=yield c("select * from activity_def"),d=(0,i.jsx)(o,Object.assign({title:"Create an event",criticalCss:!0},{children:(0,i.jsx)(h,{activityDefinition:a,selectedActivity:[],timeOptions:e},void 0)}),void 0),n=(0,t.renderToStaticMarkup)(d);s.status(200),s.send(`<!DOCTYPE html>${n}`)})))),f.get("/delete-confirm/:id",((e,s)=>b(void 0,void 0,void 0,(function*(){const a=yield c("SELECT\n      a1.*, a2.name as activity_name\n    FROM logs a1 LEFT JOIN activity_def a2\n      ON a1.activity_id = a2.id\n    WHERE a1.id = ?",[e.params.id]);if(1!==a.length)return void s.redirect("/error");const d=a[0],n={id:parseInt(e.params.id,10),event_time:d.event_time,activity_id:d.activity_id,activity_name:d.activity_name,activity_value:d.activity_value,child_id:d.child_id},A=(0,i.jsx)(o,Object.assign({title:"Delete an event activity",criticalCss:!0},{children:(0,i.jsx)(y,Object.assign({},n),void 0)}),void 0),r=(0,t.renderToStaticMarkup)(A);s.status(200),s.send(`<!DOCTYPE html>${r}`)})))),f.post("/create-event",((e,s)=>b(void 0,void 0,void 0,(function*(){const{time:a,activity:d}=e.body;if(Array.isArray(d))d.forEach((e=>b(void 0,void 0,void 0,(function*(){yield c("INSERT INTO logs (event_time, activity_id, child_id) VALUES (?, ?, ?)",[a,e,1])}))));else{if(!d){const e=(0,i.jsx)(o,Object.assign({title:"Failed",criticalCss:!0},{children:(0,i.jsx)(p,{message:"Creating event failed",error:!0},void 0)}),void 0),a=(0,t.renderToStaticMarkup)(e);return s.status(500),void s.send(`<!DOCTYPE html>${a}`)}yield c("INSERT INTO logs (event_time, activity_id, child_id) VALUES (?, ?, ?)",[a,d,1])}const n=(0,i.jsx)(o,Object.assign({title:"Succeed",criticalCss:!0},{children:(0,i.jsx)(p,{message:"Creating event succeeded",error:!1},void 0)}),void 0),A=(0,t.renderToStaticMarkup)(n);s.status(200),s.send(`<!DOCTYPE html>${A}`)})))),f.post("/delete-event",((e,s)=>b(void 0,void 0,void 0,(function*(){try{yield c("DELETE from logs WHERE id = ?",[e.body.id]);const a=(0,i.jsx)(o,Object.assign({title:"Successfully ",criticalCss:!0},{children:(0,i.jsx)(p,{message:"Deleting event succeeded",error:!1},void 0)}),void 0),d=(0,t.renderToStaticMarkup)(a);s.status(200),s.send(`<!DOCTYPE html>${d}`)}catch(e){const a=(0,i.jsx)(o,Object.assign({title:"Failed",criticalCss:!0},{children:(0,i.jsx)(p,{message:"Deleting event failed",error:!0},void 0)}),void 0),d=(0,t.renderToStaticMarkup)(a);s.status(500),s.send(`<!DOCTYPE html>${d}`)}})))),f.get("/error",((e,s)=>{const a=(0,i.jsx)(o,Object.assign({title:"Failed",criticalCss:!0},{children:(0,i.jsx)(p,{message:"Bad Request",error:!0},void 0)}),void 0),d=(0,t.renderToStaticMarkup)(a);s.status(400),s.send(`<!DOCTYPE html>${d}`)})),f.get("/static/:name",((e,i)=>{i.sendFile(R[e.params.name],{root:process.cwd()})})),f.get("/",((e,s)=>b(void 0,void 0,void 0,(function*(){const a=yield c("select * from activity_def"),d=a.reduce(((e,i)=>(e[i.id]=i,e)),{});let n,A=null;const{activity:r}=e.query;Array.isArray(r)?(n=r.map((e=>parseInt(e,10))),A=`WHERE activity_id in (${n.join(",")})`):r?(n=[parseInt(r.toString(),10)],A=`WHERE activity_id = ${r}`):(n=a.map((e=>e.id)),A="");const l=`SELECT * FROM logs ${A} ORDER BY event_time DESC LIMIT 100`,v=yield c(l),m=new Set,h={};v.forEach((e=>{const i=x(e.event_time);i in h?h[i].push(Object.assign({activity_name:d[e.activity_id].name},e)):h[i]=[Object.assign({activity_name:d[e.activity_id].name},e)],m.add(i)}),{});const j=Array.from(m).map((e=>({time:e,events:h[e]}))),u=(0,i.jsx)(o,Object.assign({title:"Baby Logs",criticalCss:!0},{children:(0,i.jsx)(E,{eventList:j,activityDefinition:a,selectedActivity:n},void 0)}),void 0),g=(0,t.renderToStaticMarkup)(u);s.status(200),s.send(`<!DOCTYPE html>${g}`)})))),f.listen(3001,(()=>{console.log("app is running on: http://localhost:3001")}))})();